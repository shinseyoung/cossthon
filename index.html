<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Mental Shield - Neuro-Cardiac Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            overscroll-behavior-y: none;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .glass-card-interactive:hover {
            transform: translateY(-5px);
            border-color: #fb923c; 
            box-shadow: 0 20px 60px rgba(251, 146, 60, 0.15); 
        }

        .btn-hover-orange { transition: all 0.2s ease; }
        .btn-hover-orange:hover {
            background-color: #f97316; 
            color: white;
            border-color: #f97316;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .heart-beat { animation: heartbeat 1.5s infinite; }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }

        .status-dot { animation: gentle-pulse 3s infinite ease-in-out; }
        @keyframes gentle-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .hidden-view { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-item.active {
            background-color: #eff6ff; color: #2563eb;
            border: 1px solid #dbeafe;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
        }
        .nav-item.active i { color: #3b82f6; }

        .mobile-nav-item.active {
            color: #2563eb;
        }
        .mobile-nav-item.active i {
            transform: translateY(-2px);
            color: #2563eb;
        }
        .mobile-nav-item.active span {
            font-weight: 700;
        }

        .calendar-day { cursor: pointer; transition: all 0.2s; }
        .calendar-day.selected { 
            border: 2px solid #6366f1; 
            transform: scale(1.1); 
            background-color: #fff;
            z-index: 10;
        }

        .mood-btn { transition: all 0.2s; opacity: 0.6; transform: scale(0.95); }
        .mood-btn:hover { opacity: 1; transform: scale(1); }
        .mood-btn.selected { opacity: 1; transform: scale(1.1); }
        .mood-btn.selected div {
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
            background-color: white;
        }

        .freq-btn { transition: all 0.2s; }
        .freq-btn.selected {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        
        input[type=range] {
            -webkit-appearance: none; height: 8px; border-radius: 5px; background: #e2e8f0; outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #ffffff; border: 2px solid currentColor; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-indigo-100 selection:text-indigo-900">

    <!-- Desktop Sidebar -->
    <aside class="hidden lg:flex w-72 bg-white border-r border-slate-200 flex-col z-20 transition-all duration-300 shadow-sm">
        <div class="p-8 pb-4 flex justify-start">
            <div onclick="switchView('home')" class="flex items-center gap-3 text-indigo-500 mb-2 cursor-pointer hover:opacity-80 transition-opacity">
                <i class="fa-solid fa-shield-heart text-2xl"></i>
                <span class="text-xl font-bold tracking-wide text-slate-800">My<span class="text-indigo-500">Shield</span></span>
            </div>
        </div>
        <nav class="flex-1 px-6 space-y-3 mt-6">
            <button onclick="switchView('home')" class="nav-item nav-item-home active w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-chart-line w-6 text-center"></i>
                <span class="font-medium">í†µí•© ëª¨ë‹ˆí„°ë§ (Monitor)</span>
            </button>
            <button onclick="switchView('journal')" class="nav-item nav-item-journal w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-book-medical w-6 text-center"></i>
                <span class="font-medium">ê°ì • ì¼ê¸° (Log)</span>
            </button>
            <button onclick="switchView('healing')" class="nav-item nav-item-healing w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-spa w-6 text-center"></i>
                <span class="font-medium">íë§ í”„ë¡œê·¸ë¨</span>
            </button>
            <button onclick="switchView('settings')" class="nav-item nav-item-settings w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-sliders w-6 text-center"></i>
                <span class="font-medium">ë¯¼ê°ë„ ì„¤ì •</span>
            </button>
        </nav>
        <div class="p-6">
            <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-100 flex items-center gap-4">
                <div class="relative">
                    <img id="sidebar-profile-img" src="https://api.dicebear.com/7.x/notionists/svg?seed=Alex" alt="Me" class="w-10 h-10 rounded-full bg-white border border-indigo-200 shadow-sm object-cover">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
                </div>
                <div>
                    <p id="sidebar-profile-name" class="text-sm font-bold text-slate-800">ë°”ì´ì˜¤í—¬ìŠ¤ 2ì¡°</p>
                    <p id="sidebar-profile-status" class="text-xs text-indigo-500 flex items-center gap-1 font-medium"><i class="fa-solid fa-lock text-[10px]"></i> Private Mode</p>
                </div>
            </div>
            <p class="text-[10px] text-slate-400 mt-2 text-center">*ë³¸ ë°ì´í„°ëŠ” íšŒì‚¬ì— ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </div>
    </aside>

    <!-- Mobile Bottom Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-slate-200 flex justify-around items-center z-50 pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <button onclick="switchView('home')" class="mobile-nav-item nav-item-home active flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-indigo-500 transition-colors">
            <i class="fa-solid fa-chart-line text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">ëª¨ë‹ˆí„°ë§</span>
        </button>
        <button onclick="switchView('journal')" class="mobile-nav-item nav-item-journal flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-indigo-500 transition-colors">
            <i class="fa-solid fa-book-medical text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">ì¼ê¸°</span>
        </button>
        <button onclick="switchView('healing')" class="mobile-nav-item nav-item-healing flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-indigo-500 transition-colors">
            <i class="fa-solid fa-spa text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">íë§</span>
        </button>
        <button onclick="switchView('settings')" class="mobile-nav-item nav-item-settings flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-indigo-500 transition-colors">
            <i class="fa-solid fa-sliders text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">ì„¤ì •</span>
        </button>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[url('https://images.unsplash.com/photo-1621252179027-94459d27d3ee?q=80&w=2670&auto=format&fit=crop')] bg-cover bg-center">
        <div class="absolute inset-0 bg-white/30 backdrop-blur-[2px] z-0"></div>

        <header class="h-16 lg:h-20 flex items-center justify-between px-4 lg:px-10 z-10 relative bg-white/10 lg:bg-transparent backdrop-blur-sm lg:backdrop-blur-none border-b lg:border-none border-white/20">
            <div class="flex items-center gap-3">
                <i onclick="switchView('home')" class="fa-solid fa-shield-heart text-2xl text-indigo-600 lg:hidden cursor-pointer hover:opacity-80 transition-opacity"></i>
                <div>
                    <h2 class="text-lg lg:text-xl text-slate-800 font-bold flex items-center gap-2 lg:gap-3">
                        <span id="header-title" class="truncate max-w-[200px] lg:max-w-none">ë‚˜ì˜ ì •ì„œ ë³´í˜¸</span>
                        <span class="hidden lg:flex px-3 py-1 bg-white/80 text-green-600 text-[10px] rounded-full border border-green-200 shadow-sm items-center gap-2">
                            <i class="fa-solid fa-shield-halved"></i> ë‡ŒíŒŒ-ì‹¬ë°• ì‹¤ì‹œê°„ ì—°ë™
                        </span>
                    </h2>
                    <p class="text-xs lg:text-sm text-slate-500 mt-0.5 lg:mt-1 hidden lg:block" id="header-desc">ë‡ŒíŒŒì™€ ì‹¬ë°•ì˜ ì •ë°€í•œ ì¡°í•© ë¶„ì„ì„ í†µí•´ ì–µëˆŒë¦° ê°ì • íŒ¨í„´ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>
                </div>
            </div>
            <button onclick="switchView('mypage')" class="bg-white hover:bg-slate-50 text-slate-600 p-2 lg:px-4 lg:py-2 rounded-lg text-sm border border-slate-200 shadow-sm transition-all font-medium flex items-center gap-2 cursor-pointer">
                <i class="fa-solid fa-circle-user text-indigo-500 text-xl lg:text-lg"></i> 
                <span class="hidden lg:inline">ë§ˆì´í˜ì´ì§€</span>
            </button>
        </header>

        <div id="content-container" class="flex-1 overflow-y-auto p-4 lg:p-8 z-10 pb-24 lg:pb-20 scroll-smooth">
            
            <!-- VIEW 1: HOME -->
            <div id="view-home" class="view-section grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6 fade-in">
                <div class="lg:col-span-8 glass-card p-5 lg:p-8 flex flex-col min-h-[520px] lg:min-h-[440px] relative">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4 z-10">
                        <div>
                            <h3 class="text-lg lg:text-xl font-bold text-slate-800 mb-1 flex items-center gap-2">
                                <i class="fa-solid fa-layer-group text-indigo-500"></i> ìƒì²´ ë°ì´í„° ë¶„ì„
                                <span id="data-timer" class="ml-2 text-xs font-mono text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full">00s / 90s</span>
                            </h3>
                            <p class="text-xs text-slate-500">ë¶„ì„ ì†ŒìŠ¤: analysis_result.json</p>
                        </div>
                        <div class="flex gap-4 text-[10px] lg:text-xs">
                            <div class="flex items-center gap-2"><span class="w-3 h-1 rounded-full bg-blue-500"></span> ë‡ŒíŒŒ</div>
                            <div class="flex items-center gap-2"><span class="w-3 h-1 rounded-full bg-red-500"></span> ì‹¬ë°•</div>
                        </div>
                    </div>

                    <div class="absolute top-20 lg:top-24 right-4 lg:right-8 z-20 flex flex-col gap-2">
                        <div class="bg-white/80 backdrop-blur px-3 py-1.5 lg:px-4 lg:py-2 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3">
                            <div class="text-red-500 heart-beat text-sm lg:text-base"><i class="fa-solid fa-heart"></i></div>
                            <div>
                                <p class="text-[9px] text-slate-400 font-bold uppercase">Heart Rate</p>
                                <p id="live-hr" class="text-sm lg:text-lg font-bold text-slate-800 leading-none">-- BPM</p>
                            </div>
                        </div>
                        <div class="bg-white/80 backdrop-blur px-3 py-1.5 lg:px-4 lg:py-2 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3">
                            <div class="text-blue-500 text-sm lg:text-base"><i class="fa-solid fa-wave-square"></i></div>
                            <div>
                                <p class="text-[9px] text-slate-400 font-bold uppercase">Emotion</p>
                                <p id="live-emotion" class="text-sm lg:text-lg font-bold text-slate-800 leading-none">Scanning...</p>
                            </div>
                        </div>
                    </div>

                    <div class="relative flex-1 bg-slate-50/50 rounded-2xl border border-white/50 overflow-hidden shadow-inner">
                        <canvas id="shieldCanvas" class="absolute inset-0 w-full h-full"></canvas>
                        
                        <div class="absolute bottom-4 left-4 right-4 lg:bottom-6 lg:left-6 lg:right-6">
                            <div id="live-alert" class="bg-white/90 backdrop-blur px-4 py-3 rounded-xl border-l-4 border-indigo-400 shadow-lg flex items-start gap-4">
                                <div class="bg-indigo-100 p-2 rounded-full text-indigo-500 shrink-0"><i class="fa-solid fa-circle-info"></i></div>
                                <div>
                                    <p id="alert-title" class="text-sm font-bold text-slate-800">ì‹œìŠ¤í…œ ë¡œë”© ì¤‘</p>
                                    <p id="alert-desc" class="text-[11px] text-slate-500 mt-1 leading-relaxed">ë¶„ì„ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-4 glass-card p-6 lg:p-8 flex flex-col justify-center items-center relative overflow-hidden text-center">
                    <h3 class="text-lg font-bold text-slate-800 mb-2">ì‹¤ì‹œê°„ ì–µëˆŒë¦¼ ì§€ìˆ˜</h3>
                    <p class="text-xs text-slate-400 mb-6 border-b border-slate-100 pb-4 w-full">Suppression Load (0-100%)</p>
                    
                    <div class="relative w-48 h-48 lg:w-56 lg:h-56 mb-6">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="50%" cy="50%" r="45%" stroke="#f1f5f9" stroke-width="12" fill="transparent" />
                            <circle id="suppressGauge" cx="50%" cy="50%" r="45%" stroke="#6366f1" stroke-width="12" fill="transparent" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round" class="transition-all duration-500"/>
                        </svg>
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                            <span id="gauge-value" class="text-4xl lg:text-5xl font-bold text-slate-800 block mb-1">0</span>
                            <span class="text-xs text-slate-400">/ 100</span>
                            <span id="gauge-label" class="mt-2 text-[10px] font-bold text-white px-3 py-1 rounded-full bg-slate-400 shadow-sm transition-colors">ì¸¡ì •ì¤‘</span>
                        </div>
                    </div>
                    <button onclick="switchView('healing')" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-medium transition-all shadow-lg shadow-indigo-200 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-mug-hot"></i> ê¸´ê¸‰ ì™„í™” ì‹œì‘
                    </button>
                </div>

                <!-- ë°ì´í„° ìš”ì•½ ë¦¬í¬íŠ¸ ì˜ì—­ -->
                <div class="lg:col-span-12 glass-card p-6 lg:p-8">
                    <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2"><i class="fa-regular fa-file-lines text-slate-400"></i> ìµœì¢… ì¸¡ì • ìš”ì•½ ë¦¬í¬íŠ¸ (90s Summary)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-indigo-50/50 p-5 rounded-xl border border-indigo-100">
                            <h4 class="text-sm font-bold text-indigo-600 mb-4 uppercase tracking-wider">ê°ì • ë¶„í¬ ë¹„ì¤‘</h4>
                            <div id="russell-summary-list" class="space-y-3">
                                <p class="text-xs text-slate-400 italic">90ì´ˆ ì¸¡ì • ì™„ë£Œ í›„ ìš”ì•½ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="bg-orange-50/50 p-5 rounded-xl border border-orange-100">
                            <h4 class="text-sm font-bold text-orange-600 mb-4 uppercase tracking-wider">ì–µëˆŒë¦¼ ìƒíƒœ ë¹„ì¤‘</h4>
                            <div id="suppress-summary-list" class="space-y-3">
                                <p class="text-xs text-slate-400 italic">90ì´ˆ ì¸¡ì • ì™„ë£Œ í›„ ìš”ì•½ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: JOURNAL -->
            <div id="view-journal" class="view-section hidden-view fade-in space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-slate-800 mb-4">12ì›”ì˜ ê°ì • ë‹¬ë ¥</h3>
                        <div class="grid grid-cols-7 gap-2 text-center text-sm mb-2 text-slate-400">
                            <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 lg:gap-2" id="calendar-grid"></div>
                    </div>
                    <div class="glass-card p-6 flex flex-col relative min-h-[400px]">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-bold text-slate-800" id="journal-date-title">ê¸°ë¡í•˜ê¸°</h3>
                            <span id="journal-status" class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">ì‘ì„± ëª¨ë“œ</span>
                        </div>
                        <div class="flex justify-around my-6" id="mood-selector">
                            <button onclick="selectMood('happy')" class="mood-btn" id="mood-happy">
                                <div class="w-12 h-12 rounded-full bg-blue-50 text-xl flex items-center justify-center border border-blue-100 shadow-sm">ğŸ™‚</div>
                                <span class="text-xs text-slate-500 mt-2 block">í‰ì˜¨</span>
                            </button>
                            <button onclick="selectMood('anxious')" class="mood-btn" id="mood-anxious">
                                <div class="w-12 h-12 rounded-full bg-orange-50 text-xl flex items-center justify-center border border-orange-300 shadow-sm">ğŸ˜°</div>
                                <span class="text-xs text-orange-600 font-bold mt-2 block">ì–µëˆŒë¦¼</span>
                            </button>
                            <button onclick="selectMood('angry')" class="mood-btn" id="mood-angry">
                                <div class="w-12 h-12 rounded-full bg-red-50 text-xl flex items-center justify-center border border-red-100 shadow-sm">ğŸ˜¡</div>
                                <span class="text-xs text-slate-500 mt-2 block">í™”ë‚¨</span>
                            </button>
                        </div>
                        <textarea id="journal-textarea" class="w-full h-32 bg-white border border-slate-200 rounded-xl p-4 text-sm focus:outline-none focus:border-indigo-500 mb-4 resize-none shadow-inner" placeholder="í‘œí˜„í•˜ì§€ ëª»í•œ ê°ì •ì„ ì ì–´ë³´ì„¸ìš”."></textarea>
                        <div class="flex gap-3 mt-auto">
                            <button onclick="deleteJournal()" id="btn-delete" class="flex-1 py-3 bg-red-50 text-red-500 border border-red-200 rounded-xl font-bold hidden">ì‚­ì œ</button>
                            <button onclick="saveJournal()" id="btn-save" class="flex-[2] py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-200">ì €ì¥í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: HEALING -->
            <div id="view-healing" class="view-section hidden-view fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-card glass-card-interactive p-0 overflow-hidden group">
                        <div class="h-40 bg-slate-200 bg-[url('https://images.unsplash.com/photo-1506126613408-eca07ce68773?q=80&w=1000&auto=format&fit=crop')] bg-cover bg-center"></div>
                        <div class="p-6">
                            <h3 class="text-lg font-bold text-slate-800 mb-2">4-7-8 í˜¸í¡ë²•</h3>
                            <p class="text-sm text-slate-500 mb-4">êµê°ì‹ ê²½ì„ ì•ˆì •ì‹œí‚¤ê³  ì‹¬ë°•ìˆ˜ë¥¼ ì¦‰ê°ì ìœ¼ë¡œ ë‚®ì¶¥ë‹ˆë‹¤.</p>
                            <button onclick="startProgram('4-7-8 í˜¸í¡ë²•')" class="w-full py-2 border border-slate-300 rounded-lg text-slate-600 btn-hover-orange transition-all">ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                    <div class="glass-card glass-card-interactive p-0 overflow-hidden group">
                        <div class="h-40 bg-slate-200 bg-[url('https://images.unsplash.com/photo-1519834785169-98be25ec3f84?q=80&w=1000&auto=format&fit=crop')] bg-cover bg-center"></div>
                        <div class="p-6">
                            <h3 class="text-lg font-bold text-slate-800 mb-2">ê°€ë©´ ë²—ê¸° ëª…ìƒ</h3>
                            <p class="text-sm text-slate-500 mb-4">íƒ€ì¸ì˜ ì‹œì„ ì—ì„œ ë²—ì–´ë‚˜ ì˜¨ì „í•œ ë‚˜ë¥¼ ë§ˆì£¼í•©ë‹ˆë‹¤.</p>
                            <button onclick="startProgram('ê°€ë©´ ë²—ê¸° ëª…ìƒ')" class="w-full py-2 border border-slate-300 rounded-lg text-slate-600 btn-hover-orange transition-all">ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                    <div id="more-programs-container" class="contents hidden">
                        <div class="glass-card glass-card-interactive p-0 overflow-hidden group">
                            <div class="h-40 bg-slate-200 bg-[url('https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?q=80&w=1000&auto=format&fit=crop')] bg-cover bg-center"></div>
                            <div class="p-6">
                                <h3 class="text-lg font-bold text-slate-800 mb-2">ìì—°ì˜ ì†Œë¦¬</h3>
                                <p class="text-sm text-slate-500 mb-4">ë‡ŒíŒŒë¥¼ ì•ˆì •ì ì¸ ì•ŒíŒŒíŒŒ ìƒíƒœë¡œ ìœ ë„í•©ë‹ˆë‹¤.</p>
                                <button onclick="startProgram('ìì—°ì˜ ì†Œë¦¬')" class="w-full py-2 border border-slate-300 rounded-lg text-slate-600 btn-hover-orange transition-all">ì‹œì‘í•˜ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 text-center" id="load-more-btn-container">
                    <button onclick="loadMorePrograms()" class="px-6 py-3 bg-white border border-slate-200 rounded-xl text-slate-600 font-bold hover:bg-slate-50 shadow-sm transition-all">ë” ë§ì€ í”„ë¡œê·¸ë¨ íƒìƒ‰</button>
                </div>
            </div>

            <!-- VIEW 4: SETTINGS -->
            <div id="view-settings" class="view-section hidden-view fade-in max-w-2xl mx-auto">
                <div class="glass-card p-8">
                    <h2 class="text-xl text-slate-800 font-bold mb-6">í™˜ê²½ ì„¤ì •</h2>
                    <div class="space-y-8">
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-slate-700 font-medium">ë¶„ì„ ë¯¼ê°ë„</label>
                                <span id="sensitivity-label" class="text-orange-500 font-bold">ë†’ìŒ (80)</span>
                            </div>
                            <input id="sensitivity-input" type="range" class="w-full accent-orange-500" min="1" max="100" value="80">
                        </div>
                        <div>
                            <label class="block text-slate-700 font-medium mb-4">ì•Œë¦¼ ë¹ˆë„</label>
                            <div class="grid grid-cols-3 gap-2" id="freq-selector">
                                <button onclick="selectFreq(1)" class="freq-btn py-2 rounded-lg border text-xs bg-white" id="freq-1">10ë¶„</button>
                                <button onclick="selectFreq(2)" class="freq-btn py-2 rounded-lg border text-xs bg-white" id="freq-2">30ë¶„</button>
                                <button onclick="selectFreq(3)" class="freq-btn py-2 rounded-lg border text-xs bg-white selected bg-indigo-600 text-white" id="freq-3">1ì‹œê°„</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-end gap-4">
                        <button onclick="saveSettings()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold shadow-lg shadow-indigo-200 transition-all">ì„¤ì • ì €ì¥</button>
                    </div>
                </div>
            </div>

            <!-- VIEW 5: MYPAGE -->
            <div id="view-mypage" class="view-section hidden-view fade-in max-w-2xl mx-auto">
                <div class="glass-card p-8">
                    <h2 class="text-xl text-slate-800 font-bold mb-6">í”„ë¡œí•„ ì„¤ì •</h2>
                    <div class="flex flex-col items-center mb-8">
                        <img id="mypage-profile-img-preview" src="https://api.dicebear.com/7.x/notionists/svg?seed=Alex" class="w-24 h-24 rounded-full bg-white border-2 border-indigo-200 mb-4 shadow-md">
                        <input id="mypage-name" type="text" class="text-center font-bold text-slate-800 p-2 border-b border-indigo-200 focus:outline-none" value="ë°”ì´ì˜¤í—¬ìŠ¤ 2ì¡°">
                    </div>
                    <button onclick="saveProfile()" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-lg transition-all">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- 1. Global Navigation ---
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden-view'));
            const selected = document.getElementById('view-' + viewName);
            if(selected) {
                selected.classList.remove('hidden-view');
                document.getElementById('content-container').scrollTop = 0;
            }

            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(n => n.classList.remove('active'));
            document.querySelectorAll('.nav-item-' + viewName).forEach(n => n.classList.add('active'));

            const titleMap = { 'home': 'ë‚˜ì˜ ì •ì„œ ë³´í˜¸', 'journal': 'ê°ì • ê¸°ë¡ ì¼ì§€', 'healing': 'ìŠ¤íŠ¸ë ˆìŠ¤ ì¼€ì–´', 'settings': 'í™˜ê²½ ì„¤ì •', 'mypage': 'ë§ˆì´í˜ì´ì§€' };
            document.getElementById('header-title').innerText = titleMap[viewName];

            if(viewName === 'home') setTimeout(resize, 50);
            if(viewName === 'journal') renderCalendar();
        }

        // --- 2. Monitoring & Data Integration ---
        let analysisData = null;
        let summaryData = null;
        let currentIndex = 0;
        let eegHistory = [];
        let ppgHistory = [];
        const MAX_HISTORY = 60; 

        async function loadAnalysisResult() {
            try {
                const response = await fetch('analysis_result.json');
                if(!response.ok) throw new Error("File not found");
                const json = await response.json();
                analysisData = json.results || json;
                summaryData = json.summary || null;
                startMonitoring();
            } catch (err) {
                console.error("Data load error:", err);
                document.getElementById('alert-title').innerText = "ë°ì´í„° íŒŒì¼ í•„ìš”";
                document.getElementById('alert-desc').innerText = "analysis_result.json íŒŒì¼ì„ ë™ì¼ í´ë”ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }

        function startMonitoring() {
            if (!Array.isArray(analysisData)) return;
            setInterval(() => {
                const step = analysisData[currentIndex];
                updateMonitoringUI(step);
                
                // Canvas History Update
                ppgHistory.push((step.raw_signals?.ppg || 0) * 100); 
                const eegVal = step.raw_signals?.fp1_mean || 0;
                eegHistory.push(eegVal === 0 ? null : eegVal * 100);

                if (ppgHistory.length > MAX_HISTORY) ppgHistory.shift();
                if (eegHistory.length > MAX_HISTORY) eegHistory.shift();

                currentIndex++;
                
                // ë£¨í”„(Loop) ë° ìš”ì•½ ê°±ì‹ 
                if (currentIndex >= analysisData.length) {
                    renderSummary(); 
                    currentIndex = 0; 
                }
            }, 1000);
        }

        function updateMonitoringUI(step) {
            if (!step) return;
            // í…ìŠ¤íŠ¸ í•„ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('data-timer').innerText = `${String(step.timestamp || 0).padStart(2, '0')}s / 90s`;
            document.getElementById('live-hr').innerText = `${step.eeg_data?.HR || '--'} BPM`;
            document.getElementById('live-emotion').innerText = step.russell?.emotion || "ì¸¡ì •ì¤‘";

            // ì–µëˆŒë¦¼ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
            const load = Math.round((step.suppression?.load || 0) * 100);
            document.getElementById('gauge-value').innerText = load;
            const gauge = document.getElementById('suppressGauge');
            gauge.style.strokeDashoffset = 283 - (283 * (load / 100));
            
            const label = document.getElementById('gauge-label');
            label.innerText = step.suppression?.state || "ë¶„ì„ì¤‘";
            label.className = `mt-2 text-[10px] font-bold text-white px-3 py-1 rounded-full shadow-sm ${load > 70 ? 'bg-red-500' : (load > 40 ? 'bg-orange-400' : 'bg-green-500')}`;

            // ì•Œë¦¼ì°½ ìƒíƒœ ì—…ë°ì´íŠ¸
            const alertTitle = document.getElementById('alert-title');
            const alertDesc = document.getElementById('alert-desc');
            const alertBox = document.getElementById('live-alert');

            if (!step.raw_signals?.fp1_mean || step.raw_signals?.fp1_mean === 0) {
                alertTitle.innerText = "ì´ˆê¸° ê¸°ì¤€ì„  ì¸¡ì • ì¤‘";
                alertDesc.innerText = "ì•ˆì •í™” ë° ë³´ì • ê¸°ê°„ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
                alertBox.className = "bg-white/95 px-4 py-3 rounded-xl border-l-4 border-slate-400 shadow-lg flex items-start gap-4";
            } else if (step.suppression?.state?.includes("Suppression")) {
                alertTitle.innerText = "ê°ì • ì–µì œ ìƒíƒœ ê°ì§€";
                alertDesc.innerText = `í˜„ì¬ [${step.russell?.emotion}] ìƒíƒœì´ë‚˜ ìƒì²´ ì‹ í˜¸ëŠ” ê°•í•œ ì–µì œë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.`;
                alertBox.className = "bg-white/95 px-4 py-3 rounded-xl border-l-4 border-orange-500 shadow-lg flex items-start gap-4";
            } else {
                alertTitle.innerText = "ì‹¤ì‹œê°„ ë¶„ì„ ëª¨ë“œ";
                alertDesc.innerText = "ë‡ŒíŒŒì™€ ì‹¬ë°• ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë™ê¸°í™” ì¤‘ì…ë‹ˆë‹¤.";
                alertBox.className = "bg-white/95 px-4 py-3 rounded-xl border-l-4 border-indigo-400 shadow-lg flex items-start gap-4";
            }
        }

        function renderSummary() {
            if (!summaryData) return;
            const rList = document.getElementById('russell-summary-list');
            rList.innerHTML = '';
            Object.entries(summaryData.russell_ratio || {}).forEach(([key, val]) => {
                rList.innerHTML += `<div class="flex items-center justify-between text-xs"><span>${key}</span><div class="flex-1 mx-3 h-1 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-indigo-500" style="width:${val}%"></div></div><span class="font-bold">${val}%</span></div>`;
            });

            const sList = document.getElementById('suppress-summary-list');
            sList.innerHTML = '';
            Object.entries(summaryData.suppression_ratio || {}).forEach(([key, val]) => {
                sList.innerHTML += `<div class="flex items-center justify-between text-xs"><span>${key}</span><div class="flex-1 mx-3 h-1 bg-slate-200 rounded-full overflow-hidden"><div class="h-full bg-orange-500" style="width:${val}%"></div></div><span class="font-bold">${val}%</span></div>`;
            });
        }

        // --- 3. Journal & LocalStorage ---
        let journalData = { 16: { mood: 'anxious', text: "íšŒì˜ ì¤‘ ì‹¬ë°•ìˆ˜ê°€ ê¸‰ê²©íˆ ìƒìŠ¹í•¨. ê²‰ìœ¼ë¡œëŠ” í‰ì˜¨í•œ ì²™ í•¨.", icon: "ğŸ˜°" } };
        let currentJournalDay = 16;
        let selectedMoodIdx = null;

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            for(let i=0; i<3; i++) grid.innerHTML += '<div></div>'; 
            for(let i=1; i<=31; i++) {
                const data = journalData[i];
                let className = "calendar-day p-2 rounded-lg border text-center text-xs " + (data ? "bg-indigo-50 border-indigo-200 font-bold" : "bg-white border-slate-100 text-slate-400 shadow-sm");
                grid.innerHTML += `<div onclick="loadJournal(${i})" class="${className}" id="day-${i}">${i}${data ? ' ' + data.icon : ''}</div>`;
            }
            loadJournal(currentJournalDay);
        }

        function loadJournal(day) {
            currentJournalDay = day;
            document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected', 'border-indigo-500'));
            const el = document.getElementById('day-' + day);
            if(el) el.classList.add('selected', 'border-indigo-500');
            
            document.getElementById('journal-date-title').innerText = `12ì›” ${day}ì¼ ê°ì • ì¼ì§€`;
            const data = journalData[day];
            const textarea = document.getElementById('journal-textarea');
            const delBtn = document.getElementById('btn-delete');
            const saveBtn = document.getElementById('btn-save');

            if(data) {
                textarea.value = data.text;
                selectMood(data.mood);
                delBtn.classList.remove('hidden');
                saveBtn.innerText = "ìˆ˜ì •í•˜ê¸°";
            } else {
                textarea.value = "";
                resetMood();
                delBtn.classList.add('hidden');
                saveBtn.innerText = "ì €ì¥í•˜ê¸°";
            }
        }

        function selectMood(mood) {
            selectedMoodIdx = mood;
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('mood-' + mood).classList.add('selected');
        }

        function resetMood() {
            selectedMoodIdx = null;
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
        }

        function saveJournal() {
            if(!selectedMoodIdx) { alert("ê°ì • ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
            const text = document.getElementById('journal-textarea').value;
            const icons = { 'happy': 'ğŸ™‚', 'anxious': 'ğŸ˜°', 'angry': 'ğŸ˜¡' };
            journalData[currentJournalDay] = { mood: selectedMoodIdx, text, icon: icons[selectedMoodIdx] };
            localStorage.setItem('ms_journal', JSON.stringify(journalData));
            renderCalendar();
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function deleteJournal() {
            if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                delete journalData[currentJournalDay];
                localStorage.setItem('ms_journal', JSON.stringify(journalData));
                renderCalendar();
            }
        }

        // --- 4. Extra Features ---
        function loadMorePrograms() {
            document.getElementById('more-programs-container').classList.remove('hidden');
            document.getElementById('load-more-btn-container').classList.add('hidden');
        }
        function startProgram(name) { alert(`[${name}] í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•©ë‹ˆë‹¤.`); }
        function selectFreq(val) {
            document.querySelectorAll('.freq-btn').forEach(b => b.classList.remove('selected', 'bg-indigo-600', 'text-white'));
            document.getElementById('freq-' + val).classList.add('selected', 'bg-indigo-600', 'text-white');
        }
        function saveSettings() { alert("ê°œì¸í™” ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); }
        function saveProfile() {
            const name = document.getElementById('mypage-name').value;
            document.getElementById('sidebar-profile-name').innerText = name;
            alert("í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        // --- 5. Canvas Drawing ---
        const canvas = document.getElementById('shieldCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            if(!canvas.parentElement) return;
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width; canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        function draw() {
            ctx.clearRect(0, 0, width, height);
            const stepX = width / (MAX_HISTORY - 1);

            // PPG (ë³¸ëŠ¥ - Red)
            if (ppgHistory.length > 1) {
                ctx.beginPath(); ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 2;
                ppgHistory.forEach((val, i) => {
                    const x = i * stepX;
                    const y = height * 0.7 - (val * 1.5);
                    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                });
                ctx.stroke();
            }

            // EEG (ì´ì„± - Blue)
            if (eegHistory.length > 1) {
                ctx.beginPath(); ctx.strokeStyle = '#3b82f6'; ctx.lineWidth = 3;
                let moved = false;
                eegHistory.forEach((val, i) => {
                    const x = i * stepX;
                    const y = (val === null) ? height * 0.3 : (height * 0.3 - val * 1.5);
                    if (!moved) { ctx.moveTo(x, y); moved = true; } else ctx.lineTo(x, y);
                });
                ctx.stroke();
            }
            requestAnimationFrame(draw);
        }

        // --- Initialization ---
        window.onload = () => {
            const stored = localStorage.getItem('ms_journal');
            if(stored) journalData = JSON.parse(stored);
            
            loadAnalysisResult();
            draw();
            renderCalendar();
        };
    </script>
</body>
</html>
