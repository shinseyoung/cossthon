<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Care Signal - ë¶€ëª¨ë‹˜ ì•ˆì‹¬ ì¼€ì–´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            overscroll-behavior-y: none;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        /* í™œë ¥ ì§€ìˆ˜ ë†’ìŒ (ì•ˆì •) */
        .glass-card-safe {
            border-left: 4px solid #3b82f6;
        }

        /* ë£¨í‹´ ì´íƒˆ ê°ì§€ (ì£¼ì˜) */
        .glass-card-warning {
            background: rgba(255, 250, 240, 0.95);
            border: 2px solid #f97316;
            animation: pulse-warning 2s infinite;
        }
        @keyframes pulse-warning {
            0% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.2); }
            70% { box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); }
            100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }

        .heart-beat { animation: heartbeat 1.5s infinite; }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }

        .nav-item.active {
            background-color: #eff6ff; color: #2563eb; /* Blue Theme */
            border: 1px solid #dbeafe;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
        }
        .nav-item.active i { color: #3b82f6; }
        
        .mobile-nav-item.active { color: #2563eb; font-weight: 700; }
        .mobile-nav-item.active i { transform: translateY(-2px); color: #3b82f6; }
        
        .hidden-view { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ë£¨í‹´ ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .routine-day { transition: all 0.2s; cursor: pointer; }
        .routine-day:hover { transform: scale(1.05); background-color: #f1f5f9; }
        .routine-day.selected { border: 2px solid #3b82f6; background-color: #eff6ff; }
        
        /* ìƒíƒœ ì  */
        .status-dot-good { background-color: #22c55e; box-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
        .status-dot-warning { background-color: #f97316; box-shadow: 0 0 10px rgba(249, 115, 22, 0.4); }

        /* ìŠ¤ìœ„ì¹˜ í† ê¸€ ìŠ¤íƒ€ì¼ (CSS ì²˜ë¦¬) */
        .toggle-track {
            width: 3rem;
            height: 1.5rem;
            background-color: #cbd5e1; /* slate-300 */
            border-radius: 9999px;
            position: relative;
            transition: background-color 0.3s ease;
        }
        .toggle-thumb {
            width: 1.25rem;
            height: 1.25rem;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* Checked state classes (JS will toggle these) */
        .toggle-track.toggle-active {
            background-color: #3b82f6; /* blue-500 default */
        }
       .toggle-track.toggle-active.red { background-color: #ef4444; }
       .toggle-track.toggle-active.green { background-color: #22c55e; }
        
        .toggle-active .toggle-thumb {
            transform: translateX(1.5rem);
        }
        
        /* ë¹„í™œì„±í™” ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .disabled-area {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(100%);
            transition: all 0.3s;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-blue-100 selection:text-blue-900">

    <aside class="hidden lg:flex w-72 bg-white border-r border-slate-200 flex-col z-20 transition-all duration-300 shadow-sm">
        <div class="p-8 pb-4 flex justify-start">
            <div onclick="switchView('home')" class="flex items-center gap-3 text-blue-600 mb-2 cursor-pointer hover:opacity-80 transition-opacity">
                <i class="fa-solid fa-leaf text-2xl text-green-500"></i>
                <span class="text-xl font-bold tracking-wide text-slate-800">Care <span class="text-blue-600">Signal</span></span>
            </div>
        </div>
        <nav class="flex-1 px-6 space-y-3 mt-6">
            <button onclick="switchView('home')" class="nav-item nav-item-home active w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-chart-line w-6 text-center"></i>
                <span class="font-medium">ì‹¤ì‹œê°„ í˜„í™© (Monitor)</span>
            </button>
            <button onclick="switchView('routine')" class="nav-item nav-item-routine w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-clipboard-check w-6 text-center"></i>
                <span class="font-medium">ë£¨í‹´ ì´íƒˆ ë¶„ì„</span>
            </button>
            <button onclick="switchView('settings')" class="nav-item nav-item-settings w-full flex items-center justify-start gap-4 p-4 text-slate-500 hover:bg-slate-50 hover:text-slate-800 rounded-2xl transition-all border border-transparent text-left">
                <i class="fa-solid fa-gear w-6 text-center"></i>
                <span class="font-medium">ì•Œë¦¼ ì„¤ì •</span>
            </button>
        </nav>
        <div class="p-6" id="sidebar-profile-area">
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 flex items-center gap-4">
                <div class="relative">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Grandpa&backgroundColor=b6e3f4" alt="Me" class="w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm object-cover">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
                </div>
                <div>
                    <p class="text-sm font-bold text-slate-800">ì•„ë²„ì§€ (ê¹€ì² ìˆ˜)</p>
                    <p class="text-xs text-green-600 flex items-center gap-1 font-medium"><i class="fa-solid fa-circle text-[6px]"></i> ì—°ê²° ìƒíƒœ ì–‘í˜¸</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Bottom Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-slate-200 flex justify-around items-center z-50 pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <button onclick="switchView('home')" class="mobile-nav-item nav-item-home active flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 transition-colors">
            <i class="fa-solid fa-chart-line text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">í˜„í™©</span>
        </button>
        <button onclick="switchView('routine')" class="mobile-nav-item nav-item-routine flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 transition-colors">
            <i class="fa-solid fa-clipboard-check text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">ë£¨í‹´ë¶„ì„</span>
        </button>
        <button onclick="switchView('settings')" class="mobile-nav-item nav-item-settings flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 transition-colors">
            <i class="fa-solid fa-gear text-lg mb-1 transition-transform"></i>
            <span class="text-[10px] font-medium">ì„¤ì •</span>
        </button>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[url('https://images.unsplash.com/photo-1544256272-3f395066928e?q=80&w=2787&auto=format&fit=crop')] bg-cover bg-center">
        <div class="absolute inset-0 bg-slate-50/90 backdrop-blur-[2px] z-0"></div>

        <header class="h-16 lg:h-20 flex items-center justify-between px-4 lg:px-10 z-10 relative bg-white/50 backdrop-blur-sm border-b border-white/20">
            <div class="flex items-center gap-3">
                <i onclick="switchView('home')" class="fa-solid fa-leaf text-2xl text-green-500 lg:hidden cursor-pointer hover:opacity-80 transition-opacity"></i>
                <div>
                    <h2 class="text-lg lg:text-xl text-slate-800 font-bold flex items-center gap-2 lg:gap-3">
                        <span id="header-title" class="truncate max-w-[200px] lg:max-w-none">ë¶€ëª¨ë‹˜ ì•ˆì‹¬ ëª¨ë‹ˆí„°ë§</span>
                        <span class="hidden lg:flex px-3 py-1 bg-white text-blue-600 text-xs rounded-full border border-blue-100 shadow-sm items-center gap-2">
                            <i class="fa-solid fa-shield-halved"></i> Care Signal Active
                        </span>
                    </h2>
                    <p class="text-xs lg:text-sm text-slate-500 mt-0.5 lg:mt-1 hidden lg:block" id="header-desc">
                        ì‹¤ì‹œê°„ ìƒì²´ ì‹ í˜¸ì™€ ë£¨í‹´ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ë¶€ëª¨ë‹˜ì˜ ì•ˆì „ì„ ì§€ì¼œë“œë¦½ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <!-- 119 Emergency Button -->
                <a href="tel:119" class="bg-red-500 hover:bg-red-600 text-white p-2 lg:px-4 lg:py-2 rounded-lg text-sm shadow-md transition-all font-bold flex items-center gap-2 animate-pulse">
                    <i class="fa-solid fa-phone-volume"></i>
                    <span class="hidden lg:inline">119 ê¸´ê¸‰ì—°ê²°</span>
                </a>
                
                <button onclick="switchView('mypage')" class="bg-white hover:bg-slate-50 text-slate-600 p-2 lg:px-4 lg:py-2 rounded-lg text-sm border border-slate-200 shadow-sm transition-all font-medium flex items-center gap-2 cursor-pointer">
                    <img src="https://api.dicebear.com/7.x/notionists/svg?seed=Son" class="w-6 h-6 rounded-full border border-slate-100">
                    <span class="hidden lg:inline">í°ì•„ë“¤ (ë³´í˜¸ì)</span>
                </button>
            </div>
        </header>

        <div id="content-container" class="flex-1 overflow-y-auto p-4 lg:p-8 z-10 pb-24 lg:pb-20 scroll-smooth">
            
            <!-- VIEW 1: HOME -->
            <div id="view-home" class="view-section grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6 fade-in">
                <!-- Live Vitality Card -->
                <div class="lg:col-span-8 glass-card glass-card-safe p-5 lg:p-8 flex flex-col min-h-[440px] relative">
                    <div class="flex justify-between items-center mb-4 gap-4 z-10">
                        <div>
                            <h3 class="text-lg lg:text-xl font-bold text-slate-800 mb-1 flex items-center gap-2">
                                <i class="fa-solid fa-activity text-blue-500"></i> ì‹¤ì‹œê°„ í™œë ¥ ì§•í›„ (Vital Signs)
                            </h3>
                            <p class="text-xs lg:text-sm text-slate-500">
                                ë‡ŒíŒŒ(ì•ˆì •)ì™€ ì‹¬ë°•(ê·œì¹™ì )ì´ ëª¨ë‘ ì •ìƒ íŒ¨í„´ì…ë‹ˆë‹¤.
                            </p>
                        </div>
                        <div class="flex gap-2 text-[10px] lg:text-xs bg-white/50 p-2 rounded-lg border border-slate-100 shadow-sm">
                            <span class="px-2 py-1 bg-blue-100 text-blue-600 rounded font-bold">ì•ˆì • ìƒíƒœ</span>
                            <span class="px-2 py-1 bg-white text-slate-500 rounded border border-slate-100">ì—°ê²°ë¨</span>
                        </div>
                    </div>

                    <!-- Live Stats Overlay -->
                    <div class="absolute top-20 lg:top-24 right-4 lg:right-8 z-20 flex flex-col gap-2">
                        <div class="bg-white/90 backdrop-blur px-3 py-1.5 lg:px-4 lg:py-2 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3">
                            <div class="text-red-400 heart-beat text-sm lg:text-base"><i class="fa-solid fa-heart"></i></div>
                            <div>
                                <p class="text-[9px] lg:text-[10px] text-slate-400 font-bold uppercase">Heart Rate</p>
                                <p class="text-sm lg:text-lg font-bold text-slate-800 leading-none">78 <span class="text-[10px] lg:text-xs font-normal text-slate-500">BPM (ì•ˆì •)</span></p>
                            </div>
                        </div>
                        <div class="bg-white/90 backdrop-blur px-3 py-1.5 lg:px-4 lg:py-2 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3">
                            <div class="text-blue-500 text-sm lg:text-base"><i class="fa-solid fa-wave-square"></i></div>
                            <div>
                                <p class="text-[9px] lg:text-[10px] text-slate-400 font-bold uppercase">Brainwave</p>
                                <p class="text-sm lg:text-lg font-bold text-slate-800 leading-none">Beta <span class="text-[10px] lg:text-xs font-normal text-slate-500">(í™œë™ì¤‘)</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas -->
                    <div class="relative flex-1 bg-gradient-to-br from-blue-50/50 to-white/50 rounded-2xl border border-white/50 overflow-hidden shadow-inner">
                        <canvas id="shieldCanvas" class="absolute inset-0 w-full h-full"></canvas>
                    </div>
                </div>

                <!-- Vitality Gauge -->
                <div class="lg:col-span-4 glass-card p-6 lg:p-8 flex flex-col justify-center items-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-green-50/50"></div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2 w-full text-center">í˜„ì¬ í™œë ¥ ì§€ìˆ˜</h3>
                    <p class="text-xs text-slate-400 mb-6 text-center border-b border-slate-200 pb-4 w-full">ì¢…í•© ìƒì²´ ì‹ í˜¸ ê¸°ë°˜ ì ìˆ˜</p>
                    
                    <div class="relative w-48 h-48 lg:w-56 lg:h-56 mb-6">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="50%" cy="50%" r="45%" stroke="#f1f5f9" stroke-width="12" fill="transparent" />
                            <circle id="suppressGauge" cx="50%" cy="50%" r="45%" stroke="#22c55e" stroke-width="12" fill="transparent" stroke-dasharray="0" stroke-dashoffset="0" stroke-linecap="round" class="transition-all duration-1000"/>
                        </svg>
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center flex flex-col items-center">
                            <span class="text-4xl lg:text-5xl font-bold text-slate-800 block mb-1">94</span>
                            <span class="text-xs text-slate-400">/ 100</span>
                            <span class="mt-2 text-[10px] whitespace-nowrap font-bold text-white px-3 py-1 rounded-full bg-green-500 shadow-sm">ë§¤ìš° ì¢‹ìŒ</span>
                        </div>
                    </div>
                    <div class="w-full text-center">
                        <p class="text-sm text-slate-600">í‰ì†Œë³´ë‹¤ ì»¨ë””ì…˜ì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                        <p class="text-xs text-slate-400">ì˜¤í›„ 2ì‹œ 30ë¶„ ê¸°ì¤€</p>
                    </div>
                </div>

                <!-- Timeline Log -->
                <div class="lg:col-span-6 glass-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2"><i class="fa-solid fa-list-check text-blue-500"></i> ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                        <span class="text-[10px] lg:text-xs text-slate-500 bg-white px-2 py-1 rounded-md shadow-sm">Today</span>
                    </div>
                    <div class="relative pl-4 border-l border-slate-300 space-y-6">
                        <div class="relative">
                            <span class="absolute -left-[21px] top-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white status-dot-good"></span>
                            <div class="pl-2">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-sm font-bold text-slate-800">14:00 - ì˜¤í›„ í™œë™ ì •ìƒ</span>
                                    <span class="text-[10px] bg-green-100 text-green-600 px-1.5 py-0.5 rounded">Routine Good</span>
                                </div>
                                <p class="text-xs text-slate-500">ì˜ˆìƒë˜ëŠ” í™œë™ ì‹œê°„(13:00~17:00)ì— ë§ì¶° ì‹ ì²´ í™œë™ëŸ‰ì´ ì ì ˆíˆ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="relative opacity-80">
                            <span class="absolute -left-[21px] top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></span>
                            <div class="pl-2">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-sm font-bold text-slate-700">12:30 - íœ´ì‹ ê°ì§€ (ì‹ì‚¬)</span>
                                </div>
                                <p class="text-xs text-slate-500">ì‹¬ë°•ìˆ˜ê°€ ì•ˆì •í™”ë˜ê³  í¸ì•ˆí•œ ë‡ŒíŒŒ íŒ¨í„´ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="relative opacity-60">
                            <span class="absolute -left-[21px] top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></span>
                            <div class="pl-2">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-sm font-bold text-slate-700">08:00 - ê¸°ìƒ ë° í™œë™ ì‹œì‘</span>
                                </div>
                                <p class="text-xs text-slate-500">í‰ì†Œ íŒ¨í„´(07:50~08:10)ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hourly Vitality Chart (Green Gradient Style) -->
                <div class="lg:col-span-6 glass-card p-6 flex flex-col">
                    <h3 class="text-lg font-bold text-slate-800 mb-2">ì‹œê°„ëŒ€ë³„ í™œë ¥ ì§€ìˆ˜</h3>
                    <p class="text-xs text-slate-500 mb-6">í•˜ë£¨ ë™ì•ˆì˜ ì—ë„ˆì§€ ë ˆë²¨ ë³€í™” ê·¸ë˜í”„</p>
                    
                    <!-- Color Legend (Green Theme) -->
                    <div class="flex items-center justify-between mb-4 text-[10px] text-slate-500 bg-slate-50 p-2 rounded-lg">
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#f0fdf4] border border-slate-200"></span>ë§¤ìš° ë‚®ìŒ</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#dcfce7]"></span>ë‚®ìŒ</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#86efac]"></span>ë³´í†µ</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#4ade80]"></span>ë†’ìŒ</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-[#16a34a]"></span>ë§¤ìš° ë†’ìŒ</div>
                    </div>

                    <div class="flex-1 min-h-[150px]"><canvas id="resilienceChart"></canvas></div>
                </div>
            </div>

            <!-- VIEW 2: ROUTINE DEVIATION (NEW) -->
            <div id="view-routine" class="view-section hidden-view fade-in space-y-6">
                <!-- Header Card -->
                <div class="glass-card p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">ë£¨í‹´ ì´íƒˆ ë¶„ì„ (Routine Check)</h2>
                        <p class="text-sm text-slate-500 mt-1">ì§€ë‚œ 30ì¼ê°„ì˜ ë°ì´í„°ë¥¼ í•™ìŠµí•˜ì—¬, í‰ì†Œ ìƒí™œ íŒ¨í„´ê³¼ ë‹¤ë¥¸ ì´ìƒ ì§•í›„ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="flex gap-2 text-xs">
                        <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-green-500"></div>ì •ìƒ</div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-orange-500"></div>ì´íƒˆ ê°ì§€</div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-slate-300"></div>ê¸°ë¡ ì—†ìŒ</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Calendar View -->
                    <div class="glass-card p-6 lg:col-span-1">
                        <h3 class="font-bold text-slate-800 mb-4 text-center">12ì›” ìƒí™œ íŒ¨í„´ ë‹¬ë ¥</h3>
                        <div class="grid grid-cols-7 gap-2 text-center text-xs text-slate-400 mb-2">
                            <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
                        </div>
                        <div class="grid grid-cols-7 gap-2" id="routine-calendar">
                            <!-- JS Generated -->
                        </div>
                    </div>

                    <!-- Detail Analysis View -->
                    <div class="glass-card p-6 lg:col-span-2 flex flex-col">
                        <div class="flex justify-between items-start mb-6">
                            <h3 class="text-lg font-bold text-slate-800" id="routine-detail-date">12ì›” 16ì¼ (ì˜¤ëŠ˜) ë¶„ì„</h3>
                            <span class="bg-green-100 text-green-600 px-3 py-1 rounded-full text-xs font-bold" id="routine-status-badge">íŒ¨í„´ ì¼ì¹˜ (ì •ìƒ)</span>
                        </div>

                        <!-- Comparison Visual -->
                        <div class="space-y-6 flex-1">
                            <!-- Item 1: Wake Up -->
                            <div class="relative">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="font-bold text-slate-700"><i class="fa-regular fa-sun text-orange-400 mr-2"></i>ê¸°ìƒ ì‹œê°„</span>
                                    <span class="text-slate-500">í‰ì†Œ 06:00 Â± 30ë¶„</span>
                                </div>
                                <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden relative">
                                    <!-- Normal Range -->
                                    <div class="absolute top-0 bottom-0 bg-slate-200 w-1/3 left-1/4" title="í‰ì†Œ ë²”ìœ„"></div> 
                                    <!-- Today's Marker -->
                                    <div class="absolute top-0 bottom-0 w-2 bg-blue-500 rounded-full left-[28%]" id="marker-wakeup"></div>
                                </div>
                                <p class="text-xs text-blue-600 mt-1 text-right font-medium" id="text-wakeup">ì˜¤ëŠ˜: 06:15 (ì •ìƒ)</p>
                            </div>

                            <!-- Item 2: Activity Level (ìš©ì–´ ë³€ê²½ë¨) -->
                            <div class="relative">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="font-bold text-slate-700"><i class="fa-solid fa-person-walking text-green-600 mr-2"></i>ì˜¤ì „ ì‹ ì²´ í™œë™ëŸ‰</span>
                                    <span class="text-slate-500">í‰ì†Œ ë†’ìŒ(BetaíŒŒ)</span>
                                </div>
                                <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden relative flex">
                                    <div class="h-full bg-gradient-to-r from-green-300 to-green-500 w-3/4 rounded-full transition-all duration-1000" style="width: 85%" id="bar-activity"></div>
                                </div>
                                <p class="text-xs text-green-600 mt-1 text-right font-medium" id="text-activity">ì˜¤ëŠ˜: 85% (í™œë°œí•¨)</p>
                            </div>

                            <!-- Item 3: Heart Rate Variability -->
                            <div class="relative">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="font-bold text-slate-700"><i class="fa-solid fa-heart-pulse text-red-400 mr-2"></i>í‰ê·  ì‹¬ë°• ë³€ì´</span>
                                    <span class="text-slate-500">í‰ì†Œ 70-90 BPM</span>
                                </div>
                                <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden relative">
                                    <div class="absolute top-0 bottom-0 bg-slate-200 w-1/4 left-[35%]" title="í‰ì†Œ ë²”ìœ„"></div>
                                    <div class="absolute top-0 bottom-0 w-2 bg-blue-500 rounded-full left-[40%]" id="marker-heart"></div>
                                </div>
                                <p class="text-xs text-blue-600 mt-1 text-right font-medium" id="text-heart">ì˜¤ëŠ˜: 78 BPM (ì•ˆì •)</p>
                            </div>
                        </div>

                        <!-- Analysis Text -->
                        <div class="mt-8 bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <h4 class="text-sm font-bold text-slate-800 mb-2">ğŸ¤– Care Signal AI ë¶„ì„ ë¦¬í¬íŠ¸</h4>
                            <p class="text-sm text-slate-600 leading-relaxed" id="routine-ai-text">
                                í˜„ì¬ ì•„ë²„ë‹˜ì˜ ìƒí™œ íŒ¨í„´ì€ ì§€ë‚œ 30ì¼ ë°ì´í„°ì™€ <strong>98% ì¼ì¹˜</strong>í•©ë‹ˆë‹¤. 
                                ì•„ì¹¨ ê¸°ìƒ ì‹œê°„ê³¼ ì˜¤ì „ í™œë™ëŸ‰ì´ ë§¤ìš° ê·œì¹™ì ì´ë©°, ê±´ê°• ìƒíƒœê°€ ì–‘í˜¸í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤. 
                                íŠ¹ì´ì‚¬í•­ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 4: SETTINGS (Modified with Advanced Alerts) -->
            <div id="view-settings" class="view-section hidden-view fade-in max-w-2xl mx-auto">
                <div class="glass-card p-8">
                    <h2 class="text-xl text-slate-800 font-bold mb-6">ë³´í˜¸ì ë° ìë™ ì‹ ê³  ì„¤ì •</h2>
                    
                    <div class="space-y-10">
                        <!-- ì„¹ì…˜ 1: ë£¨í‹´ ê°ë„ -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <label class="text-slate-700 font-medium">ë£¨í‹´ ì´íƒˆ ë¯¼ê°ë„</label>
                                <span id="routine-sensitivity-label" class="text-blue-600 font-bold">ë³´í†µ</span>
                            </div>
                            <input id="routine-sensitivity-slider" type="range" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500" min="1" max="100" value="50" oninput="updateSensitivity(this.value)">
                            <p class="text-xs text-slate-500 mt-2">í‰ì†Œ ê¸°ìƒ ì‹œê°„ë³´ë‹¤ 1ì‹œê°„ ì´ìƒ ëŠ¦ì–´ì§€ë©´ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.</p>
                        </div>
                        
                        <!-- ì„¹ì…˜ 2: ë¹„ìƒ ì—°ë½ë§ ë° ìë™ ì‹ ê³  -->
                        <div class="pt-6 border-t border-slate-200">
                            <h3 class="text-slate-700 font-bold mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-bell text-orange-500"></i> ìë™ ì•Œë¦¼ ë° ì‹ ê³  ê¶Œí•œ
                            </h3>
                            <p class="text-xs text-slate-400 mb-4 bg-slate-50 p-2 rounded">
                                * ì˜¤ì‘ë™ ë°©ì§€ë¥¼ ìœ„í•´ ìë™ ì‹ ê³  ì¡°ê±´ì€ ë³´ìˆ˜ì ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                            </p>

                            <!-- 119 ìë™ ì‹ ê³  -->
                            <div class="mb-4 bg-red-50 border border-red-100 rounded-xl overflow-hidden">
                                <div onclick="toggleSwitch('toggle-119')" class="flex items-center justify-between p-4 bg-red-50 cursor-pointer hover:bg-red-100/50 transition-colors">
                                    <div>
                                        <p class="text-sm font-bold text-red-600">ğŸš‘ 119 ìë™ ê¸´ê¸‰ ì‹ ê³ </p>
                                        <p class="text-xs text-slate-500">ì˜ì‹ ë¶ˆëª…/ì‹¬ì •ì§€ ì˜ì‹¬ ì‹œ ìë™ ì—°ê²°</p>
                                    </div>
                                    <div id="toggle-119" class="toggle-track">
                                        <div class="toggle-thumb"></div>
                                    </div>
                                </div>
                                <div id="options-119" class="p-4 text-xs space-y-2 border-t border-red-100 bg-white/50 disabled-area">
                                    <div class="flex justify-between items-center">
                                        <span class="text-slate-600">ìë™ ì‹ ê³  íŠ¸ë¦¬ê±°</span>
                                        <select class="bg-white border border-slate-300 rounded px-2 py-1 text-slate-700">
                                            <option>ì‹¬ê°í•¨ (ì˜ì‹ì†Œì‹¤+ì‹¬ë°•ê¸‰ì¦)</option>
                                            <option>ë§¤ìš° ìœ„ê¸‰ (ì‹¬ì •ì§€ ì˜ì‹¬)</option>
                                        </select>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-slate-600">ì‹ ê³  ì „ ëŒ€ê¸°ì‹œê°„ (ê³¨ë“ íƒ€ì„)</span>
                                        <select class="bg-white border border-slate-300 rounded px-2 py-1 text-slate-700">
                                            <option>1ë¶„ ëŒ€ê¸° (ê¶Œì¥)</option>
                                            <option>3ë¶„ ëŒ€ê¸°</option>
                                            <option>ì¦‰ì‹œ ì‹ ê³ </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- ë³´í˜¸ì ì•Œë¦¼ -->
                            <div class="mb-4 bg-blue-50 border border-blue-100 rounded-xl overflow-hidden">
                                <div onclick="toggleSwitch('toggle-son')" class="flex items-center justify-between p-4 bg-blue-50 cursor-pointer hover:bg-blue-100/50 transition-colors">
                                    <div>
                                        <p class="text-sm font-bold text-slate-800">í°ì•„ë“¤ (ë³¸ì¸)</p>
                                        <p class="text-xs text-slate-500">010-1234-5678</p>
                                    </div>
                                    <div id="toggle-son" class="toggle-track toggle-active">
                                        <div class="toggle-thumb"></div>
                                    </div>
                                </div>
                                <div class="p-4 flex justify-between items-center text-xs bg-white/50 border-t border-blue-100">
                                    <span class="text-slate-600">ì•Œë¦¼ ìˆ˜ì‹  ê¸°ì¤€</span>
                                    <div class="flex gap-2">
                                        <span class="text-blue-600 font-bold bg-white px-2 py-1 rounded border border-blue-100">ëª¨ë“  ì´ìƒ ì§•í›„ (ë£¨í‹´ ì´íƒˆ í¬í•¨)</span>
                                        <button onclick="editContact('í°ì•„ë“¤')" class="text-xs bg-white border border-slate-300 px-2 py-1 rounded shadow-sm text-slate-600 hover:bg-slate-50">ìˆ˜ì •</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ì´ì¥ë‹˜/ì§€ì¸ ì•Œë¦¼ -->
                            <div class="bg-slate-50 border border-slate-200 rounded-xl overflow-hidden">
                                <div onclick="toggleSwitch('toggle-neighbor')" class="flex items-center justify-between p-4 bg-slate-50 cursor-pointer hover:bg-slate-100 transition-colors">
                                    <div>
                                        <p class="text-sm font-bold text-slate-800">ì´ì¥ë‹˜ (ë§ˆì„)</p>
                                        <p class="text-xs text-slate-500">010-9876-5432</p>
                                    </div>
                                    <div id="toggle-neighbor" class="toggle-track green">
                                        <div class="toggle-thumb"></div>
                                    </div>
                                </div>
                                <div id="options-neighbor" class="p-4 flex justify-between items-center text-xs bg-white/50 border-t border-slate-200 disabled-area">
                                    <span class="text-slate-600">ì•Œë¦¼ ìˆ˜ì‹  ê¸°ì¤€</span>
                                    <div class="flex gap-2">
                                        <select class="bg-white border border-slate-300 rounded px-2 py-1 text-slate-700">
                                            <option>ë³´í˜¸ì ì—°ë½ ë‘ì ˆ ì‹œì—ë§Œ</option>
                                            <option>ê¸´ê¸‰ ìƒí™©(ì‹¤ì‹  ë“±) ì‹œ ì¦‰ì‹œ</option>
                                        </select>
                                        <button onclick="editContact('ì´ì¥ë‹˜')" class="text-xs bg-white border border-slate-300 px-2 py-1 rounded shadow-sm text-slate-600 hover:bg-slate-50">ìˆ˜ì •</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 5: MY PAGE -->
             <div id="view-mypage" class="view-section hidden-view fade-in max-w-2xl mx-auto">
                <!-- ìƒëµ (ê¸°ì¡´ê³¼ ìœ ì‚¬) -->
            </div>

        </div>
    </main>

    <script>
        // --- View Switching ---
        function switchView(viewName) {
            const views = document.querySelectorAll('.view-section');
            views.forEach(view => view.classList.add('hidden-view'));
            
            const selectedView = document.getElementById('view-' + viewName);
            if(selectedView) {
                selectedView.classList.remove('hidden-view');
                document.getElementById('content-container').scrollTop = 0;
            }

            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelectorAll('.mobile-nav-item').forEach(nav => nav.classList.remove('active'));

            const targets = document.querySelectorAll('.nav-item-' + viewName);
            targets.forEach(t => t.classList.add('active'));

            const titleMap = { 'home': 'ë¶€ëª¨ë‹˜ ì•ˆì‹¬ ëª¨ë‹ˆí„°ë§', 'routine': 'ìƒí™œ ë£¨í‹´ ë¶„ì„', 'settings': 'ë³´í˜¸ì ì•Œë¦¼ ì„¤ì •', 'mypage': 'ë‚´ ì •ë³´' };
            document.getElementById('header-title').innerText = titleMap[viewName];
            
            if(viewName === 'home') requestAnimationFrame(draw);
        }
        
        // --- Settings Logic (Direct Handlers) ---
        function updateSensitivity(val) {
            const label = document.getElementById('routine-sensitivity-label');
            let text = "ë³´í†µ";
            let colorClass = "text-blue-600";
            
            if (val < 33) {
                text = "ë‘”ê°";
                colorClass = "text-green-600";
            } else if (val > 66) {
                text = "ë¯¼ê°";
                colorClass = "text-orange-500";
            }
            
            label.innerText = text;
            label.className = `${colorClass} font-bold`;
        }

        function toggleSwitch(id) {
            const element = document.getElementById(id);
            element.classList.toggle('toggle-active');
            
            // ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€ (Visual Feedback)
            if(id === 'toggle-119') {
                element.classList.toggle('red');
                const options = document.getElementById('options-119');
                if(element.classList.contains('toggle-active')) options.classList.remove('disabled-area');
                else options.classList.add('disabled-area');
            } 
            else if(id === 'toggle-neighbor') {
                element.classList.toggle('green');
                const options = document.getElementById('options-neighbor');
                if(element.classList.contains('toggle-active')) options.classList.remove('disabled-area');
                else options.classList.add('disabled-area');
            }
        }

        // 3. Edit Buttons
        window.editContact = function(name) {
            alert(`'${name}' ì—°ë½ì²˜ ìˆ˜ì • íŒì—…ì´ ëœ¹ë‹ˆë‹¤. (ê¸°ëŠ¥ ì¤€ë¹„ì¤‘)`);
        }

        // --- Routine Calendar Logic ---
        const routineData = {
            1: 'good', 2: 'good', 3: 'good', 4: 'warning', 5: 'good', 6: 'good', 7: 'good',
            8: 'good', 9: 'warning', 10: 'good', 11: 'good', 12: 'good', 13: 'good', 14: 'good',
            15: 'good', 16: 'good'
        };

        function renderRoutineCalendar() {
            const grid = document.getElementById('routine-calendar');
            grid.innerHTML = '';
            // Empty slots for alignment
            for(let i=0; i<3; i++) grid.innerHTML += '<div></div>';
            
            for(let i=1; i<=31; i++) {
                const status = routineData[i];
                let colorClass = "bg-slate-100 text-slate-400"; // Default (Future/No Data)
                
                if (status === 'good') colorClass = "bg-green-100 text-green-600 font-bold border border-green-200 status-dot-good";
                else if (status === 'warning') colorClass = "bg-orange-100 text-orange-600 font-bold border border-orange-200 status-dot-warning";

                grid.innerHTML += `<div onclick="loadRoutineDetail(${i})" class="routine-day h-8 flex items-center justify-center rounded-lg text-xs ${colorClass}" id="r-day-${i}">${i}</div>`;
            }
        }

        function loadRoutineDetail(day) {
            // UI Update
            document.querySelectorAll('.routine-day').forEach(d => d.classList.remove('selected'));
            const el = document.getElementById('r-day-' + day);
            if(el) el.classList.add('selected');

            const isWarning = routineData[day] === 'warning';
            
            document.getElementById('routine-detail-date').innerText = `12ì›” ${day}ì¼ ë¶„ì„ ê²°ê³¼`;
            const badge = document.getElementById('routine-status-badge');
            const aiText = document.getElementById('routine-ai-text');

            if(isWarning) {
                badge.innerText = "ë£¨í‹´ ì´íƒˆ ê°ì§€ (ì£¼ì˜)";
                badge.className = "bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-xs font-bold";
                
                // Example of Warning Data
                document.getElementById('marker-wakeup').style.left = "60%"; // Late wake up
                document.getElementById('text-wakeup').innerText = "ì˜¤ëŠ˜: 08:30 (ëŠ¦ìŒ)";
                document.getElementById('text-wakeup').className = "text-xs text-orange-500 mt-1 text-right font-bold";

                document.getElementById('bar-activity').style.width = "30%"; // Low activity
                document.getElementById('bar-activity').className = "h-full bg-gradient-to-r from-orange-300 to-orange-500 w-3/4 rounded-full transition-all duration-1000";
                document.getElementById('text-activity').innerText = "ì˜¤ëŠ˜: 30% (ì €ì¡°í•¨)";
                document.getElementById('text-activity').className = "text-xs text-orange-500 mt-1 text-right font-bold";

                aiText.innerHTML = `í‰ì†Œë³´ë‹¤ <strong>2ì‹œê°„ 30ë¶„ ëŠ¦ê²Œ ê¸°ìƒ</strong>í•˜ì…¨ìœ¼ë©°, ì˜¤ì „ í™œë™ëŸ‰ì´ í‰ì†Œì˜ 40% ìˆ˜ì¤€ì…ë‹ˆë‹¤. <br>ì»¨ë””ì…˜ ë‚œì¡° í˜¹ì€ ëª¸ì‚´ ê¸°ìš´ì´ ì˜ì‹¬ë˜ë‹ˆ <strong>ì•ˆë¶€ ì „í™”ë¥¼ ê¶Œì¥</strong>ë“œë¦½ë‹ˆë‹¤.`;
            } else {
                badge.innerText = "íŒ¨í„´ ì¼ì¹˜ (ì •ìƒ)";
                badge.className = "bg-green-100 text-green-600 px-3 py-1 rounded-full text-xs font-bold";

                // Normal Data
                document.getElementById('marker-wakeup').style.left = "28%";
                document.getElementById('text-wakeup').innerText = "ì˜¤ëŠ˜: 06:15 (ì •ìƒ)";
                document.getElementById('text-wakeup').className = "text-xs text-blue-600 mt-1 text-right font-medium";

                document.getElementById('bar-activity').style.width = "85%";
                document.getElementById('bar-activity').className = "h-full bg-gradient-to-r from-green-300 to-green-500 w-3/4 rounded-full transition-all duration-1000";
                document.getElementById('text-activity').innerText = "ì˜¤ëŠ˜: 85% (í™œë°œí•¨)";
                document.getElementById('text-activity').className = "text-xs text-green-600 mt-1 text-right font-medium";

                aiText.innerHTML = `í˜„ì¬ ì•„ë²„ë‹˜ì˜ ìƒí™œ íŒ¨í„´ì€ ì§€ë‚œ 30ì¼ ë°ì´í„°ì™€ <strong>98% ì¼ì¹˜</strong>í•©ë‹ˆë‹¤. <br>ì•„ì¹¨ ê¸°ìƒ ì‹œê°„ê³¼ ì˜¤ì „ í™œë™ëŸ‰ì´ ë§¤ìš° ê·œì¹™ì ì´ë©°, íŠ¹ì´ì‚¬í•­ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
            }
        }


        // --- Canvas & Chart (Updated for Heart Rate + EEG) ---
        const canvas = document.getElementById('shieldCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, offset = 0;
        function resize() {
            if(!canvas.parentElement) return;
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width; canvas.height = height;
        }
        window.addEventListener('resize', resize);
        setTimeout(resize, 100);

        function draw() {
            if(document.getElementById('view-home').classList.contains('hidden-view')) return;
            ctx.clearRect(0, 0, width, height);

            // Baseline
            ctx.strokeStyle = 'rgba(0,0,0,0.05)';
            ctx.beginPath(); ctx.moveTo(0, height/2); ctx.lineTo(width, height/2); ctx.stroke();

            // 1. Brainwave (Alpha - Calm/Blue) - Smooth Sine Wave
            // Represents "Trying to be calm" (Cognitive Control)
            ctx.beginPath(); 
            ctx.strokeStyle = '#3b82f6'; // Blue
            ctx.lineWidth = 3;
            ctx.shadowBlur = 0;
            for (let i = 0; i < width; i++) {
                // Smooth gentle wave
                const y = height / 2 + Math.sin((i + offset) * 0.02) * 30 + Math.sin((i + offset * 0.5) * 0.01) * 10;
                ctx.lineTo(i, y);
            }
            ctx.stroke();

            // 2. Heart Rate (ECG Style - Agitated/Red) - Jagged Pulse
            // Represents "Internal Stress/Suppression" (Physiological Arousal)
            ctx.beginPath(); 
            ctx.strokeStyle = '#ef4444'; // Red
            ctx.lineWidth = 2;
            ctx.shadowBlur = 5; 
            ctx.shadowColor = 'rgba(239, 68, 68, 0.4)';
            
            for (let i = 0; i < width; i++) {
                let y = height / 2;
                
                // Create ECG-like spikes intermittently
                // Using modulus to create periodic beats
                const beatPos = (i - offset * 3) % 200; // Fast speed
                
                if (beatPos > 0 && beatPos < 20) {
                    // P wave
                    y += Math.sin(beatPos * 0.3) * 5;
                } else if (beatPos >= 20 && beatPos < 40) {
                    // QRS complex (The big spike)
                    if (beatPos < 30) y -= (beatPos - 20) * 8; // Up (inverted Y in canvas)
                    else y += (40 - beatPos) * 8; // Down
                } else if (beatPos >= 40 && beatPos < 70) {
                    // T wave
                    y += Math.sin((beatPos - 40) * 0.1) * 8;
                } else {
                    // Baseline noise (Tremor/Stress)
                    y += (Math.random() - 0.5) * 5;
                }
                
                // Add general erratic offset to show high BPM
                y += Math.sin((i + offset * 2) * 0.05) * 10;

                ctx.lineTo(i, y);
            }
            ctx.stroke(); ctx.shadowBlur = 0; 
            
            offset += 1.5; // Speed
            requestAnimationFrame(draw);
        }

        // --- Chart (Restored Style: Dots + Gradient + Green Theme) ---
        const chartCtx = document.getElementById('resilienceChart').getContext('2d');
        // Vitality Data over the day
        const vitalityData = [65, 80, 85, 90, 75, 70]; 

        const getColorByValue = (v) => {
            if (v <= 20) return '#f0fdf4';
            if (v <= 40) return '#dcfce7';
            if (v <= 60) return '#86efac';
            if (v <= 80) return '#4ade80';
            return '#16a34a'; // Dark Green
        };

        function getRGBA(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function getMatchingGradient(ctx, chartArea, data) {
            const gradient = ctx.createLinearGradient(chartArea.left, 0, chartArea.right, 0);
            // Green Gradient
            gradient.addColorStop(0, getRGBA('#22c55e', 0.4));
            gradient.addColorStop(1, getRGBA('#22c55e', 0.1));
            return gradient;
        }

        new Chart(chartCtx, {
            type: 'line',
            data: {
                labels: ['07:00', '09:00', '11:00', '13:00', '15:00', '17:00'],
                datasets: [
                    {
                        label: 'í™œë ¥ ì§€ìˆ˜',
                        data: vitalityData,
                        borderColor: '#16a34a', // Darker Green for line
                        borderWidth: 2.5,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: (ctx) => getColorByValue(ctx.raw),
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        zIndex: 2
                    },
                    {
                        label: 'ë°°ê²½ ê·¸ë¼ë°ì´ì…˜',
                        data: vitalityData.map(v => Math.max(0, v - 5)), 
                        backgroundColor: function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return 'transparent';
                            return getMatchingGradient(ctx, chartArea, vitalityData);
                        },
                        fill: true,
                        borderWidth: 0,
                        pointRadius: 0,
                        tension: 0.4,
                        zIndex: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                layout: { padding: { bottom: 10 } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { min: 0, max: 100, display: false }
                }
            }
        });

        // Gauge Animation
        setTimeout(() => { 
            const gauge = document.getElementById('suppressGauge'); 
            if(gauge) {
                // 94% Fill
                gauge.style.strokeDasharray = "283"; 
                gauge.style.strokeDashoffset = "17"; 
            } 
        }, 500);

        // Init
        renderRoutineCalendar();
        loadRoutineDetail(16);
        draw();

    </script>
</body>
</html>
